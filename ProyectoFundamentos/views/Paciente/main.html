<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil del Paciente</title>
    <link rel="stylesheet" href="/ProyectoFundamentos/views/Paciente/pacienteMain.css">
    <link rel="icon" type="image/x-icon" href="/ProyectoFundamentos/Assets/icon/doctor.png">
    <script src="https://cdn.lordicon.com/lordicon.js"></script>
    <script src="/ProyectoFundamentos/js/jquery.js"></script>
</head>

<body>

    <lord-icon class="P" herf="#" src="https://cdn.lordicon.com/gwvmctbb.json" trigger="hover" id="logoutIcon">Cerrar
        Sesión</lord-icon>
    <br>
    <br>
    <div class="container">
        <center>
            <h1 style="color: rgb(255, 255, 255);">Lista de Citas Disponibles</h1>
        </center>
        <div class="container1">
            <div class="search-container">
                <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Buscar citas...">
            </div>
            <button class="open-popup-btn" onclick="openApprovedPopup()">Abrir citas aprobadas</button>

            <!-- Botón para abrir las citas rechazadas en la pantalla emergente -->
            <button class="open-popup-btn" onclick="openRejectedPopup()">Abrir citas rechazadas</button>

            <table id="appointmentsTable">
                <thead>
                    <tr>
                        <th>Doctor</th>
                        <th>tipo de Cita</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="bodyTable">
                    <!-- Agrega más filas según sea necesario -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Ventana emergente (modal) para confirmar la cita -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Confirmar Cita</h2>
            </div>
            <div class="modal-body">
                <p>El doctor puede aceptar o rechazar esta cita este pendiente de su estado en la tablas.</p>
                <p>¿Estás seguro de que quieres confirmar esta cita?</p>
                <button onclick="updateCita(event)" id="confirmButton" class="confirm-button">Confirmar</button>
            </div>
        </div>
    </div>



    <div id="popup-container" class="popup-container">
        <div class="popup">
            <button class="close-popup-btn" onclick="closePopup()">X</button>
            <div id="Approved" class="tabcontent">
                <h3>Citas Aprobadas</h3>
                <div class="container1">
                    <div class="search-container">
                        <input type="text" id="searchInputApproved" onkeyup="searchTable('Approved')"
                            placeholder="Buscar citas aprobadas...">
                    </div>
                    <table id="appointmentsTableApproved">
                        <!-- Aquí irán las citas aprobadas -->
                    </table>
                </div>
            </div>
            <div id="Rejected" class="tabcontent">
                <h3>Citas Rechazadas</h3>
                <div class="container1">
                    <div class="search-container">
                        <input type="text" id="searchInputRejected" onkeyup="searchTable('Rejected')"
                            placeholder="Buscar citas rechazadas...">
                    </div>
                    <table id="appointmentsTableRejected">
                        <!-- Aquí irán las citas rechazadas -->
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            cargarTabla();
            // Obtener la ventana emergente (modal)
            var modal = document.getElementById("myModal");

            // Obtener el botón para cerrar la ventana emergente
            var span = document.getElementsByClassName("close")[0];

            // Agregar evento de escucha al documento
            document.addEventListener('click', function (event) {
                if (event.target.classList.contains('action-checkbox')) {
                    // Mostrar la ventana emergente
                    modal.style.display = "block";
                }
            });

            // Función para cerrar la ventana emergente cuando se hace clic en el botón de cerrar
            span.onclick = function () {
                modal.style.display = "none";
                // Deseleccionar todos los checkboxes
                var checkboxes = document.querySelectorAll('.action-checkbox');
                checkboxes.forEach(function (checkbox) {
                    checkbox.checked = false;
                });
            };

            // Función para confirmar la cita
            document.getElementById("confirmButton").addEventListener('click', function () {
                modal.style.display = "none";
            });
        });

        // Función para cargar la tabla de citas
        async function cargarTabla() {
            $("#bodyTable").empty();
            const citas = await getAppointment(100);
            citas.forEach(cita => {
                let filaHTML = `<tr id="row-id${cita.id}"> 
            <td>${cita.doctor.name + ' ' + cita.doctor.last_name + ', Cedula:' + cita.doctor.cedula}</td> 
            <td>${cita.name}</td>
            <td>${cita.date}</td>
            <td>${cita.hour}</td>
            <td>${cita.status}</td>
            <td><input data-doctorId="${cita.doctor.id}" data-name="${cita.name}" data-date="${cita.date}" data-hour="${cita.hour}" data-id="${cita.id}" type="checkbox" class="action-checkbox"></td>
            </tr>`;
                $("#bodyTable").append(filaHTML);
            });
        }

        async function cargarCitasAprobadas() {
            $("#bodyTable").empty();
            const citas = await getAppointment(100);
            citas.forEach(cita => {
                let filaHTML = `<tr id="row-id${cita.id}"> 
            <td>${cita.doctor.name + ' ' + cita.doctor.last_name + ', Cedula:' + cita.doctor.cedula}</td> 
            <td>${cita.name}</td>
            <td>${cita.date}</td>
            <td>${cita.hour}</td>
            <td>${cita.status}</td>
            <td><input type="checkbox" class="action-checkbox"></td>
            </tr>`;
                $("#bodyTable").append(filaHTML);
            });
        }

        async function cargarCitasRechazadas() {
            
            $("#bodyTable").empty();
            const citas = await getAppointment(100);
            citas.forEach(cita => {
                let filaHTML = `<tr id="row-id${cita.id}"> 
            <td>${cita.doctor.name + ' ' + cita.doctor.last_name + ', Cedula:' + cita.doctor.cedula}</td> 
            <td>${cita.name}</td>
            <td>${cita.date}</td>
            <td>${cita.hour}</td>
            <td>${cita.status}</td>
            <td><input type="checkbox" class="action-checkbox"></td>
            </tr>`;
                $("#bodyTable").append(filaHTML);
            });

            citas.forEach(cita => {
                if (cita.status === "Aceptada") {
                    $(`#row-id${cita.id} .action-checkbox`).prop("disabled", true);
                }
            });
        }

        // Función para buscar en la tabla
        function searchTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("appointmentsTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0]; // Buscar en la primera columna (Doctor)
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }


        // Función para abrir la pantalla emergente de citas aprobadas
        function openApprovedPopup() {
            document.getElementById("popup-container").style.display = "block";
            document.getElementById("Approved").style.display = "block";
            document.getElementById("Rejected").style.display = "none";
        }

        // Función para abrir la pantalla emergente de citas rechazadas
        function openRejectedPopup() {
            document.getElementById("popup-container").style.display = "block";
            document.getElementById("Approved").style.display = "none";
            document.getElementById("Rejected").style.display = "block";
        }
        function closePopup() {
            document.getElementById("popup-container").style.display = "none";
        }
    </script>

    <script src="/ProyectoFundamentos/js/services/patient_service.js"></script>
    <script src="/ProyectoFundamentos/js/app.js"></script>
    <script src="/ProyectoFundamentos/views/logout.js" defer></script>

</body>

</html>